<hello xmlns="urn:ietf:params:xml:ns:netconf:base:1.0">
    <capabilities>
        <capability>urn:ietf:params:netconf:base:1.0</capability>
    </capabilities>
</hello>
]]>]]>

<?xml version="1.0"?>
<rpc xmlns="urn:ietf:params:xml:ns:netconf:base:1.0" xmlns:ns2="urn:com:ericsson:ecim:1.0" xmlns:ns3="http://tail-f.com/ns/netconf/actions/1.0" xmlns:ns4="urn:ietf:params:xml:ns:yang:ietf-netconf-monitoring"
    xmlns:ns5="urn:ietf:params:xml:ns:netconf:notification:1.0" message-id="0">
    <edit-config>
        <target>
            <running />
        </target>
        <config>
            <scp-function xmlns="urn:rdns:com:ericsson:oammodel:ericsson-scp">
                <nf-instance>
                    <name>scp_instance_1</name>
                    <own-network>
                        <name>internalNetwork</name>
                        <service-address-ref>serviceAddress1</service-address-ref>
                        <routing-case-ref>default_routing</routing-case-ref>
                    </own-network>
                    <ingress-connection-profile>
                        <name>ingress_profile_1</name>
                        <max-connection-duration>60</max-connection-duration>
                    </ingress-connection-profile>
                    <ingress-connection-profile-ref>ingress_profile_1</ingress-connection-profile-ref>
                    <egress-connection-profile>
                      <name>egress_profile_1</name>
                      <hpack-table-size>0</hpack-table-size>
                      <max-requests>16384</max-requests>
                      <max-pending-requests>16384</max-pending-requests>
                      <max-connections>16384</max-connections>
                      <max-connection-duration>0</max-connection-duration>
                      <max-concurrent-streams>2147483647</max-concurrent-streams>
                      <tcp-connect-timeout>2</tcp-connect-timeout>
                      <connection-idle-timeout>3600</connection-idle-timeout>
                      <tcp-keepalive>
                        <probes>6</probes>
                        <time>5</time>
                        <interval>5</interval>
                      </tcp-keepalive>
                    </egress-connection-profile>
                    <egress-connection-profile-ref>egress_profile_1</egress-connection-profile-ref>
                    <message-data>
                        <name>routing_binding_data</name>
                        <header>3gpp-Sbi-Routing-Binding</header>
                        <extractor-regex>^\s*bl=nf-set;\s*nfset=(?P&lt;setid&gt;.+)$</extractor-regex>
                    </message-data>
                    <message-data>
                        <name>setID_data</name>
                        <header>3gpp-Sbi-Discovery-nf-set-id</header>
                        <variable-name>setid</variable-name>
                    </message-data>
                    <routing-case>
                        <name>default_routing</name>
                        <message-data-ref>setID_data</message-data-ref>                     
                        <message-data-ref>routing_binding_data</message-data-ref>
                        <routing-rule>
                            <name>Send_to_ownPLMN_NfUdm_set1_rr</name>
                            <condition>var.setid=='set1.udmset.5gc.mnc073.mcc262'</condition>
                            <routing-action>
                                <name>NfUdm_rr</name>
                                <action-route-round-robin>
                                    <target-nf-pool>
                                        <nf-pool-ref>NfUdm_rr_pool</nf-pool-ref>
                                    </target-nf-pool>
                                    <failover-profile-ref>fop1</failover-profile-ref>
                                </action-route-round-robin>
                            </routing-action>
                        </routing-rule>                     
                        <routing-rule>
                            <name>Send_to_ownPLMN_NfUdm_set2_pr</name>
                            <condition>var.setid=='set2.udmset.5gc.mnc073.mcc262' and req.header['3gpp-sbi-target-apiRoot'] exists</condition>
                            <routing-action>
                                <name>NfUdm_pref</name>
                                <action-route-preferred>
                                    <preserve-if-indirect-routing>target-api-root-header</preserve-if-indirect-routing>
                                    <from-target-api-root-header></from-target-api-root-header>
                                    <target-nf-pool>
                                        <nf-pool-ref>NfUdm_pr_pool</nf-pool-ref>
                                    </target-nf-pool>
                                    <failover-profile-ref>fop1</failover-profile-ref>
                                </action-route-preferred>
                            </routing-action>
                        </routing-rule>
                    </routing-case>
                    <static-scp-instance-data>
                        <name>scp02</name>
                        <static-scp-instance>
                            <name>scp02-instance</name>
                            <nf-type>scp</nf-type>
                            <static-nf-service>
                                <name>nudm-uecm</name>
                                <address>
                                    <fqdn>scp2.region1.scp.5gc.mnc073.mcc262.3gppnetwork.org</fqdn>
                                </address>
                            </static-nf-service>
                        </static-scp-instance>
                    </static-scp-instance-data>
                    <nf-pool>
                        <name>NfUdm_rr_pool</name>                     
                        <nf-pool-discovery>
                            <name>NfUdm_rr_dyn_pool</name>
                            <update-interval>5s</update-interval>
                            <nrf-query>
                                <name>NF_UDM</name>
                                <nf-type>udm</nf-type>
                                <nf-set-id>set1.udmset.5gc.mnc073.mcc262</nf-set-id>
                            </nrf-query>
                        </nf-pool-discovery>
                    </nf-pool>
                    <nf-pool>
                        <name>NfUdm_pr_pool</name>
                        <nf-pool-discovery>
                            <name>NfUdm_pr_dyn_pool</name>
                            <update-interval>5s</update-interval>
                            <nrf-query>
                                <name>NF_UDM</name>
                                <nf-type>udm</nf-type>
                                <nf-set-id>set2.udmset.5gc.mnc073.mcc262</nf-set-id>
                            </nrf-query>
                        </nf-pool-discovery>
                    </nf-pool>                
                    <failover-profile>
                        <name>fop1</name>
                        <request-time-budget>3456</request-time-budget>
                        <retry-condition>
                            <http-status>500</http-status>
                            <http-status>501</http-status>
                            <http-status>502</http-status>
                            <http-status>503</http-status>
                            <http-status>504</http-status>
                            <reset>false</reset>
                            <connect-failure>false</connect-failure>
                            <refused-stream>false</refused-stream>
                        </retry-condition>
                        <preferred-host-retries-max>1</preferred-host-retries-max>
                        <target-nf-pool-reselects-max>3</target-nf-pool-reselects-max>
                        <target-timeout>2345</target-timeout>
                    </failover-profile>
                    <nf-profile>
                        <name>scpNfProfile1</name>
                        <service-address-ref>serviceAddress1</service-address-ref>
                        <nf-type>scp</nf-type>
                        <requested-heartbeat-timer>30</requested-heartbeat-timer>
                        <service-priority>1</service-priority>
                        <capacity>100</capacity>
                    </nf-profile>
                    <service-address>
                        <name>serviceAddress1</name>
                        <fqdn>scp1.region1.scp.5gc.mnc073.mcc262.3gppnetwork.org</fqdn>
                        <port>31313</port>
                        <tls-port>31313</tls-port>
                        <ipv4-address>10.63.135.191</ipv4-address>						
                    </service-address>
                    <nrf-group>
                        <name>nrfGroup1</name>
                        <nf-profile-ref>scpNfProfile1</nf-profile-ref>
                        <nrf>
                            <name>nrfSim1</name>
                            <fqdn>eric-nrfsim</fqdn>                            
                            <priority>10</priority>
                            <scheme>http</scheme>
                            <ip-endpoint>
                                <name>nrfSim1_ep</name>
                                <port>32425</port>
                                <ipv4-address>10.63.143.68</ipv4-address>
                            </ip-endpoint>
                            <retry-timeout>1500</retry-timeout>
                            <max-retries>0</max-retries>
                            <nf-profile-ref>scpNfProfile1</nf-profile-ref>
                        </nrf>
                    </nrf-group>
                    <nrf-service>
                        <nf-management>
                            <nrf-group-ref>nrfGroup1</nrf-group-ref>
                        </nf-management>
                        <nf-discovery>
                            <nrf-group-ref>nrfGroup1</nrf-group-ref>
                        </nf-discovery>
                    </nrf-service>
                </nf-instance>
            </scp-function>
        </config>
    </edit-config>
</rpc>
]]>]]>

